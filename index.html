<!DOCTYPE html>
<html lang="en">
	<head>
    <meta charset="utf-8"/>
    <meta name="Description" content="Stats Collector">
    <meta name="theme-color" content="#FFCF07">
    <meta name="msapplication-TileColor" content="#FFCF07">

    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#FFCF07">

    <link rel="stylesheet" href="style.css" >

  	<script src="jquery-3.4.0.min.js"></script>

    
    <title>Stats Collector</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body class="locations" id="projector">
		<div id="homepage" class="screen">
			<h1>Welcome! </h1>
			<p>Welcome message.... Team based on Team? This might be hard to do with version 1 - unless we encode it into the URL  something like: .com/index.html#onboarding="Hi there team!"</p>

		</div>

		<div id="onboarding" class="screen">
			<h1>Welcome! </h1>
			<h4>Select the Movements below that you would like to add stats for.  Once this is setup your device will remember your preferences</h4>
			<div id="movements">
				<input id="one" name="one" type="checkbox" >
				<label for="one" >University at Buffalo</label>	<br>
				<input id="two" name="two" type="checkbox" >
				<label for="two" >Daemen</label>	<br>
			</div>
			<input id="name" name="name" type="text" placeholder="Name">
			<input id="phone" name="phone" type="tel" placeholder="Phone">
			<div>
				<input id="ua" name="ua" type="checkbox" >
				<label for="ua" >I agree to the <a href="google.com">Cru User Agreement</a></label>
			</div>
			<button>Setup Device</button>

		</div>

		<div id="locations" class="screen">
			<h1>Welcome! - </h1>
			<p>Amanda, thank you for all you do to help people find Jesus on campus!  We hope that you'll be encouraged as you celebrate what God has done in and through you by sharing about the following key activities.</p>

		<form>
			<div id="fiftypercent">
				<div>
					<input id="startDate" name="startDate" type="date"><br>
					<label for="startDate">Last Reported Date</label>
				</div>
				<div>
					<input id="endDate" name="endDate" type="date"><br>
					<label for="endDate">Today's Date</label>
				</div>
			</div>

			<h2 id="movementName">University of Central Florida Cru</h2>

		  <div id="statsList">
				<label for="spiritualConvo">Spiritual Conversations</label>
				<input id="spiritualConvo" type="number" min="0" max="100" step="1" inputmode="numeric">
				<label for="personalEvang">Personal Evangelism</label>
				<input id="personalEvang" type="number" min="0" max="100" step="1"  inputmode="numeric">
				<label for="personalEvangDec">Personal Evangelism Descions</label>
				<input id="personalEvangDec" type="number" min="0" max="100" step="1"  inputmode="numeric">
				<label for="holySpiritPres">Holy Spirit Presentations</label>
				<input id="holySpiritPres" type="number" min="0" max="100" step="1"  inputmode="numeric">
				<button>Next</button>
			</div>
		</form>


		</div>

		<div id="summary" class="screen">
			<h1>Our Stats</h1>

			<br><br><br><br>
			<img src="greatWork.png" width="100%">
			<br><br><br><br>
			<div id="summaryText"><h2>1 HS conversation has been added to your movement!</h2></div><br><br><br>

			<div id="lastScore">
				<button onclick="location = 'https://infobase.cru.org';">Last Score sheet(infobase)</button>
			</div>
			<br><br><br>

			<button onclick="location.hash='';">back</button>

		</div>

		<script>

			if ('serviceWorker' in navigator) {
			  navigator.serviceWorker.register('sw.js', {
			    scope: './'
			  })
			  .then((serviceWorker) => {
			    console.log('service worker registration successful');
			  })
			  .catch((err) => {
			    console.error('service worker registration failed');
			    console.error(err);
			  });
			} else {
			  console.log('service worker unavailable');
			}
/*
Visit

Initialize
   If no localstorage
	   prompt for initialization
	      Add Movements from link address, checkboxes.
	      Enter Name
	      Enter Phone
	      Checkbox, I agree to Cru UA

   if storage and movements start paging through movements
      One movement per page.

All go through intialize
   URL = index.html - shows what?
         index.html#onboard&locations=4369,49903,20302,23020
         index.html#onboard - page for onboarding
         index.html#locations/4369 - movement pages
         index.html#summary  - summary view
         index.html# - back to beginning, which shows what?

    user.name = ""
    user.phone = ""
    user.locations = [,,,,]

*/
			$(function() { 

			});


			function toggleActive(el){
				el.closest('.row').classList.toggle('active'); 
				el.closest('.screen').classList.toggle('active');
        
        let movement = document.getElementById('movement');
				let disabled = movement.disabled;
				if(disabled == true) {
					movement.disabled = false;
				}
				else {
					movement.disabled = true;
				}
			}

			function getUser(){
				return JSON.parse(localstorage.getItem('user'));
			}
			function setUser(user){
				localstorage.setItem('user', JSON.stringify(user));
				return;
			}

			document.addEventListener("DOMContentLoaded", function(){
				var user = getUser();

				if(user){

				}
				else{
					//redirect to intilizations

				}

	      window.addEventListener("hashchange", hashchanged, false);
	      document.getElementById("movement").disabled=true;
	      hashchanged();
	    });

			function hashchanged(){
        var hash = location.hash;

        if(hash == ''){
          document.getElementById('projector').classList = 'homepage';
          window.document.title = "Stats Collectors";
        }
        else if(hash.startsWith('#submit')) {
        	document.getElementById('projector').classList = 'summary';
        	window.document.title = "Stats Summary";
        }
      }     
      function addLocationtoList() {
      	let loca = prompt("What's the location's name?");
      	let movement = document.getElementById('movement');
      	movement.insertAdjacentHTML('beforeend', '<option value="" selected>'+ loca + '</option>');
      }
      function summarize() {
      	let inputs = document.querySelectorAll('.screen.active .row.active input');
      	let stats = [];
      	inputs.forEach(function(input) { 
      		if(input.type == 'number'){
      			if(input.value > 0) {
      				stats.push(input.value + ' ' + input.name);
      			}
      			input.value = '';
      		}
      		else if(input.type == 'checkbox') {
      			if(input.checked) {
      				stats.push('1 ' + input.name);	
      			}
      			input.checked = false;
      		}
				});
				let s = ' has';
				if(stats.length > 1) {
          s = 's have';
				}
				let summary = '<h2>'+stats.join(', ') + ' conversation'+s+' been added to your movement!</h2><br><br><br><h2>3 more days until your team gets a new stats score sheet! Check back then :)</h2>';
				document.getElementById('summaryText').innerHTML = summary;
      	location.hash = 'submit';
      	document.querySelectorAll('.active').forEach(function(active) {
      		active.classList.remove('active');
      	});

	      document.getElementById("movement").disabled = true;
	      document.getElementById("summary").scrollTop = 0;
      }
    
		</script>
	</body>
</html>